<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Underpass: Statistics Collection</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Underpass
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Statistics Collection </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A large focus of Underpass's design is to support statistics collection from the OSM <a class="el" href="md_doc_changefile.html">change data</a>. Currently this has been focused on producing statistics for the <a href="https://www.missingmaps.org/">Missing Maps</a> <a href="http://www.missingmaps.org/leaderboards/#/missingmaps">Leaderboard</a> and the <a href="https://www.redcross.org/">Red Cross</a> <a href="https://www.missingmaps.org/osmstats/">Osm Stats</a> websites.</p>
<p>These two sites only track organized mapathons that have <a href="http://www.missingmaps.org/partners/assets/docs/Guide%20for%20using%20hashtags%20and%20the%20leaderboard%20(MSFT).pdf">hashtags</a>. The statsistics these sites are interested in is mapping progress for the campaign. This is primarily concerned with tracking how many buildings, highways, POIs, and waterways were either added or modified. The totals are listed spreadsheet style.</p>
<h1><a class="anchor" id="autotoc_md31"></a>
OSM Stats</h1>
<p>The Red Cross maintains statistics of changes, so it's possible to track the mapping progress of individual users and campaigns. Currently this data is acquired using <a href="https://osm.gs.mil/features/overpass">Overpass</a> to generate an <a href="https://wiki.openstreetmap.org/wiki/Overpass_API/Augmented_Diffs">augmented diff</a>, which is then parsed by javascript code in the web frontend. The Underpass writes directly to the <em>osmstats</em> database, and avoids the overhead of both Overpass and parsing the diff file. It contains a number of tables, some of which are documented here:</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Table  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">raw_changesets  </td><td class="markdownTableBodyNone">Contains all the data of the changeset   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">raw_changesets_countries  </td><td class="markdownTableBodyNone">Contains the changeset ID and an index into the raw_changesets table   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">raw_changesets_hashtags  </td><td class="markdownTableBodyNone">Contains the changeset ID and the an index into the raw_hashtag table   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">raw_countries  </td><td class="markdownTableBodyNone">Contains an index number, and the country or state name plus a display abbreviation   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">raw_hashtags  </td><td class="markdownTableBodyNone">Contains an index number and hashtag used   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">raw_users  </td><td class="markdownTableBodyNone">Contains only the user ID and name   </td></tr>
</table>
<p>The main table is <em>raw_changesets</em>, which contains calculated statistics from the change data. This table gets populated with data from both change files. Because Underpass is multi-threaded, different columns are written at different times. Once complete, the <em>updated_at</em> field is set with the current timestamp.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Table  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">id  </td><td class="markdownTableBodyNone">This is the ID of the changeset, and comes from the changeset file   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">road_km_added  </td><td class="markdownTableBodyNone">This value is updated by counting the length of roads added or deleted by the user in the change file   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">road_km_modified  </td><td class="markdownTableBodyNone">This value is updated by counting the length of   </td></tr>
</table>
<p>existing roads modified by the user in the change file waterway_km_added| This value is updated by counting the length of waterways added or deleted by the user in the change file waterway_km_modified| This value is updated by counting the length of existing waterways modified by the user in the change file roads_added| This value is updated by counting the roads added or deleted by the user in the change file roads_modified| This value is updated by counting the existing roads modified by the user in the change file waterways_added| This value is updated by counting the roads added or deleted by the user in the change file waterways_modified| This value is updated by counting the existing waterways modified by the user in the change file buildings_added| This value is updated by counting the buildings added by the user in the change file buildings_modified| This value is updated by counting the existing buildings modified by the user in the change file pois_added| This value is updated by counting the POIs added by the user in the change file pois_modified| This value is updated by counting the existing POIs modified by the user in the change file editor| The editor used, and comes from the changeset user_id| The user ID, comes from the changeset created_at| The timestamp this changeset was created, comes from the changeset closed_at| The timestamp this changeset was closed, comes from the changeset verified| Whether this data has been validated updated_at| The timestamp this change was applied to the database</p>
<h1><a class="anchor" id="autotoc_md32"></a>
Data Available For Statistics</h1>
<p>This is a list of the available raw data sources for generating statistics. These can be filtered by a timestamp or range, or limited to a specific area using a polygon.</p>
<h1><a class="anchor" id="autotoc_md33"></a>
ChangeSet File</h1>
<p>This file from the OSM is available with minute, hourly, or daily updates, called replication files. It documents the change itself, and not the data of the change. This is mostly used for statistics collection as it contains the hashtags and/or comments made when the change was uploaded.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Created_at  </td><td class="markdownTableBodyNone">When this changeset was created   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Closed_at  </td><td class="markdownTableBodyNone">When this changeset is completed, normally a few minutes   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">User ID  </td><td class="markdownTableBodyNone">User ID in OSM of the mapper   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Username  </td><td class="markdownTableBodyNone">Username in OSM of the mapper   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Change location  </td><td class="markdownTableBodyNone">Bounding Box coordinates of this change   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Various OSM tags  </td><td class="markdownTableBodyNone">Existing metadata tags used for OSM   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md34"></a>
OsmChange File</h1>
<p>This file documents the data that got changed, and handles new data, modified data, and deleted data. This includes the OSM tags that changed. This file from the OSM is available with minute, hourly, or daily updates.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Version of the change  </td><td class="markdownTableBodyNone">Incremented on each upload   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Timestamp of the change  </td><td class="markdownTableBodyNone">When this change was made   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Location of the change  </td><td class="markdownTableBodyNone">GPS coordinates of this change   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Change tags  </td><td class="markdownTableBodyNone">Any changed tags for an OSM element   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md35"></a>
What is in an OSM Element ?</h2>
<p>An OSM element is the actual map data . Because of the large variety of metadata tags, many statistics can be generated by analyzing the tags.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword  </th><th class="markdownTableHeadNone">Description   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">The Object ID  </td><td class="markdownTableBodyNone">The ID of the OSM object   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">The User ID  </td><td class="markdownTableBodyNone">The OSM user ID who edited this object   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">The Username  </td><td class="markdownTableBodyNone">The OSM username who edited this object   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">The type  </td><td class="markdownTableBodyNone">Node, way, or relation   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">The location  </td><td class="markdownTableBodyNone">GPS coordinates for a node   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Nodes  </td><td class="markdownTableBodyNone">List of node IDs for a way   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Members  </td><td class="markdownTableBodyNone">List of member objects IDs in a relation   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Version of the change  </td><td class="markdownTableBodyNone">Incremented on each upload   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Timestamp  </td><td class="markdownTableBodyNone">When this change was made   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Various OSM tags  </td><td class="markdownTableBodyNone">Existing metadata tags used for OSM   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md36"></a>
OSM Tags</h2>
<p>Currently use building, waterway, and highway tags </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
