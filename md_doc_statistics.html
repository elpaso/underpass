<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Underpass: Statistics Database</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Underpass
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Statistics Database </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The new statistics database schema is very different from the current one used for <a class="el" href="md_doc_osmstats.html">OSM Stats</a>. The current database schema is more oriented towards supporting the display functions, and is not extensable beyond the few features it collects data about.</p>
<p>The new schema is designed to be more flexible to track more types of features, as well as to be more flexible on the types of queries it can suppport. By adding spatial data, it can filter data extracts by polygon. The current implementaion is limited to using country boundaries.</p>
<h1><a class="anchor" id="autotoc_md33"></a>
geoboundaries table</h1>
<p>This a static table, the data is maintained outside of this project. It can be produced by extracting administrative boundaries from OpenStreetMap data to updfate if changes are made to the boundaries. This table is not used by backend, it's primarily to assist the frontend to create a list of existing polygons that can be used by the frontend to filter data. Rather than the existing raw_countries table in the osmstats schema which was English only, this one support internationalized names, and both the official 2 and 3 letter ISO abbreviations.</p>
<p>Currently this table contains the data for most countries, and US states. Other boundaries could also be added, and using admin_level to differentiate them from the existing ones. For example, this could also be populated by Tasking Manager project boundaries.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">cid   </td><td class="markdownTableBodyNone">An internal ID for this administrative boundary    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">name   </td><td class="markdownTableBodyNone">The name of the boundary    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">admin_level   </td><td class="markdownTableBodyNone">The administrative level of this boundary    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">tags   </td><td class="markdownTableBodyNone">Other metadata related to this boundary    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">boundary   </td><td class="markdownTableBodyNone">The multipolygon of this boundary   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md34"></a>
changesets table</h1>
<p>This is the primary table used to contain the data for each changeset. All of the data is stored in a table for better query performance on large data sets. It also limits needing SQL <a href="https://www.postgresql.org/docs/13/functions-subquery.html">sub queries</a> or a <a href="https://www.postgresql.org/docs/13/tutorial-join.html">JOIN</a> between tables, reducing complexity.</p>
<p>An <a href="https://www.postgresql.org/docs/13/hstore.html">hstore</a> is used to store the statistics instead of having a separate table for each feature to allow for more flexibility. An hstore is a key &amp; value pair, and multiple data items can be stored in a single column, indexed by the key. This allows for more features to be added by the backend and the frontend, without having modify the database schema.</p>
<p>An example query to count the total number of buildings added by the user <b>4321</b> for a Tasking Manager project <b>1234</b> would be this:</p>
<blockquote class="doxtable">
<p>SELECT SUM(CAST(added::hstore-&gt;'building' AS DOUBLE precision)) FROM </p>
</blockquote>
<p>changesets WHERE 'hotosm-project1234' = ANY(hashtags) AND user_id=4321;</p>
<p>&#160;</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">id   </td><td class="markdownTableBodyNone">The ID of this changeset    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">editor   </td><td class="markdownTableBodyNone">The editor used for this changeset    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">user_id   </td><td class="markdownTableBodyNone">The OSM User ID of the mapper    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">created_at   </td><td class="markdownTableBodyNone">The timestamp    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">closed_at   </td><td class="markdownTableBodyNone">The timestamp    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">updated_at   </td><td class="markdownTableBodyNone">The timestamp    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">added   </td><td class="markdownTableBodyNone">An array of the added map features    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">modified   </td><td class="markdownTableBodyNone">An array of the modified map features    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">deleted   </td><td class="markdownTableBodyNone">An array of the deleted map features    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">hashtags   </td><td class="markdownTableBodyNone">An array of the hashtags used for this changeset    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">source   </td><td class="markdownTableBodyNone">The imagery source used for this changeset    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">validated   </td><td class="markdownTableBodyNone">Where this changeset has been validated in the tasking manager    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">bbox   </td><td class="markdownTableBodyNone">The bounding box of this changeset   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md35"></a>
users table</h1>
<p>Tnis table contains data on mappers, and is used to track indivigual activity. Often badges are given based on this data.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">id   </td><td class="markdownTableBodyNone">The OSM ID of this mapper    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">name   </td><td class="markdownTableBodyNone">The OSM user name of the mapper    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">tm_registration   </td><td class="markdownTableBodyNone">The timestamp of when the mapper registered with the tasking manager    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">osm_registration   </td><td class="markdownTableBodyNone">The timestamp of when the mapper registered with openstreetmap    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">gender   </td><td class="markdownTableBodyNone">The mappers gender, when available    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">home   </td><td class="markdownTableBodyNone">The mappers home location, when available   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md36"></a>
ground data table</h1>
<p>This table collects statistics on ground mapping campaigns, which contains different metadata that gets lost when the data is edited for uploading to OpenStreetMap. This table is currently a placeholder for future developement at this time, so unused for now,</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Keyword   </th><th class="markdownTableHeadNone">Description    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">starttime   </td><td class="markdownTableBodyNone">The timestamp of when the user opened the app and started data collection    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">endtime   </td><td class="markdownTableBodyNone">The timestamp for when the data collection was completed    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">username   </td><td class="markdownTableBodyNone">The username of the mapper, not the same as an OSM username    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">changeset_id   </td><td class="markdownTableBodyNone">Changeset ID applied when the data is uploaded to OSM    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">location   </td><td class="markdownTableBodyNone">The coordinates of this POI   </td></tr>
</table>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
