<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Underpass: mainpage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Underpass
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">mainpage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> Underpass is a C++ API and utility programs for mainipulating OpenStreetMap data at the database and raw data file level. It can download replication file from the OSM planet server and use these files to update a local copy of the OSM database, or analysze the changes to generate statistics.</p>
<p>Currently this is usually done using Overpass, which can be self-hosted or accessed remotely. Overpass has major performance issues though, namely it’s single threaded, and doesn’t use a real database. What Overpass does is support a wide range of querying OSM data, and can handle rather complicated filters. Much of that functionality is not needed for supporting statistics collection.</p>
<p>Underpass is designed to function as a replacement for a subset of Overpass’s functionality. It is focused on producing the statistics for the Missing Maps Leaderboard, and the Red Cross OSM Stats in a timely fashion.</p>
<p>Rather than using disk based files, it has a self-hosted database centric design for better performance. It uses Postgresql with the Postgis extension, both commonly used for core OSM infrastructure. One big advantage of using postgres is it supports utilizing multi-core processors for faster SQL queries. It can optionally use <a href="https://heterodb.github.io/pg-strom/">GPU support</a> for faster geospatial queries.</p>
<p>The other primary design goal of Underpass is to be maintainable for the long term. It uses common open source infrastructure to make it accessible to community developers. The primary dependencies, which are used by multiple other core OSM projects are these:</p>
<ul>
<li>Uses the GNU <a href="https://www.gnu.org/software/automake/manual/html_node/Autotools-Introduction.html">autotools</a> for multi-platform support</li>
<li>Uses <a href="http://www.swig.org/">SWIG</a> for bindings to multiple languages</li>
<li>Uses <a href="https://www.boost.org/">Boost</a> for additional C++ libraries</li>
<li>Uses <a href="https://www.gdal.org">GDAL</a> for reading Geospatial files)</li>
</ul>
<p>Ideally Underpass can be used by other projects needing to do similar tasks without Overpass. It should be able to support collecting more statistics than are currently used. Since much of Underpass deals with the low level data flow of OpenStreetMap, long-term it can be used to support future projects as a common infrastructure for database oriented mapping tasks.</p>
<p>A critical future project is conflation and validation of existing data and mapathons. Underpass will support the database management tasks those projects will need. The same database can also be used for data exports, and Underpass can be used to keep that data up to date. What the Overpass data store contains is history information, change information, and the actual OSM data.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Replicator</h1>
<p>Replicator is a command line utility for updating a database from changeset and change files, suitable for being run as a cron job or daemon. Both change files and changesets need to be updated to stay in sync. Updated data can be downloaded from the OSM <a href="https://planet.openstreetmap.org">planet</a>, server, and has to be applied to the database. Data is processed as a stream, so a large disk for temporary files or much memory isn’t needed.</p>
<p>Remote directories on planet are named with a 3 digit number. The top level directory covers many years in only a few directories. Each subdirectory is also named with 3 digits, and covers several months.</p>
<p>Under each following subdirectory, are more 3 digit subdirectories. Each one of these contains the actual data. The data comprises of files created with a minute interval. Each minute update consists of two files. One is the state file, which has the starting timestamp of the data file. The data file has the changes. To update the data, each file needs to be applied in sequence. Both the state file and the data file also start with a 3 digit number. Once there are 1000 entries in the subdirectory containing the data files, a new directory is created for the next 1000 entries.</p>
<p>Currently there is no utility to import Changeset files, which contain hashtags and comments, into a database. The replicator utility parses the changeset information and imports it into the database. The data fields in the changeset file that get imported are the changeset ID, the User ID, the hashtag or comment, and the creation and closed timestamp.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Dependencies</h1>
<p>Underpass requires a modern C++ compiler that supports the 2011 C++ standard. The 2011 standard simplified the syntax by adding the <em>auto</em> keyword, and thread support became part of the standard C++ library. Underpass is a heavy user of of the <em>boost</em> libraries, and also requires reasonably up to date C++ libraries for other dependencies. Underpass also uses the ranges-v3 library. This will be in the 2020 C++ standard.</p>
<p>Fedora 33, Debian Buster, and Ubuntu Groovy contain a package for libranges-v3, which is the code base for what will be in C++ 2020. Both Debian Buster and Ubuntu Groovy ship <em>libpqxx 6.x</em>, which has a bug which has been fixed in <em>libpqxx 7.x</em>. Fedora 33 ships the newer version. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
